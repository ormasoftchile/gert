apiVersion: tool/v0

meta:
  name: curl
  description: Transfer data from or to a server using HTTP, HTTPS, FTP, and more
  binary: curl
  transport: stdio

contract:
  effects: [network]
  writes: []
  idempotent: true
  deterministic: false
  inputs:
    url:
      type: string
      required: true
  outputs:
    status_code:
      type: string
    response:
      type: string
    status:
      type: string

actions:
  get:
    description: Perform an HTTP GET request and return the status code
    argv: ["-s", "-o", "/dev/null", "-L", "-w", "%{http_code}", "{{ .url }}"]
    extract:
      status_code:
        from: stdout

  post:
    description: Perform an HTTP POST request with a JSON body
    argv: ["-s", "-L", "-X", "POST", "-H", "Content-Type: application/json", "-d", "{{ .body }}", "-w", "\n%{http_code}", "{{ .url }}"]
    extract:
      status_code:
        from: stdout
      response:
        from: stdout

  head:
    description: Fetch only the HTTP response headers
    argv: ["-s", "-I", "{{ .url }}"]
    extract:
      response:
        from: stdout

  download:
    description: Download a file to a local path
    argv: ["-s", "-L", "-o", "{{ .output }}", "{{ .url }}"]
    extract:
      response:
        from: stdout
