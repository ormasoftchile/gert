apiVersion: runbook/v1
meta:
    name: iterate-basic
    description: Basic iterate convergence test
tree:
    - step:
        id: init
        type: cli
        title: Initialize counter
        with:
            argv: ["echo", "0"]
        capture:
            counter: stdout
    - iterate:
        max: 5
        until: 'counter == "3"'
        steps:
            - step:
                id: increment
                type: cli
                title: Increment counter (pass {{ .iteration }})
                with:
                    argv: ["echo", "{{ .counter }}+1"]
                capture:
                    counter: stdout
    - step:
        id: done
        type: cli
        title: Final check
        with:
            argv: ["echo", "converged at {{ .counter }}"]
